<!DOCTYPE html>
<title>Power analyzer</title>
<meta charset="utf-8">
<meta name=viewport content='width=device-width,initial-scale=1,maximum-scale=1'>
<link rel=manifest href='data:application/manifest+json,{
    "name":"GCC Power Analyzer",
    "display":"standalone",
    "start_url":"https://gc-classic.github.io/analyzer",
    "icons":[{"src":"https://gc-classic.github.io/favicon.ico","type":"image/webp","sizes":"192x192"},{"src":"https://gc-classic.github.io/favicon.ico","type":"image/webp","sizes":"512x512","purpose":"maskable"}]
}'>
<script type="module">
    import {A,E,O,Q} from 'https://aeoq.github.io/AEOQ.mjs'
    Object.assign(E, {
        icon: (prop, attr) => E('prop-icon', {prop, ...attr ?? {}}),
        bilingual: (...text) => (text.length === 1 ? text[0].split('|') : text).map(t => E('span', t)),
    });
    Object.assign(window, {A,E,O,Q});
</script>
<script>navigator.serviceWorker.register('/worker.js')</script>
<link rel="stylesheet" href="/common.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Monda:wght@700&family=Shippori+Antique&family=Sofia+Sans+Condensed:wght@600;800&display=swap" rel="stylesheet">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FPLGF8M093"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FPLGF8M093');
</script>

<header>
    <details>
        <summary><span>Reminders</span><span>æç¤º</span></summary>
        <ul>
            <li>
                <span><a href='https://www.youtube.com/watch?v=wVdpA3gaWjY' target='_blank'>Demonstration video</a></span>
                <span><a href='https://www.youtube.com/watch?v=wVdpA3gaWjY' target='_blank'>ç¤ºç¯„å½±ç‰‡</a></span>
            <li>
                <span>All content will be saved to your current browser automatically.</span>
                <span>æ‰€æœ‰å…§å®¹è‡ªå‹•ä¿å­˜è‡³ä½ æ­£ä½¿ç”¨çš„ç€è¦½å™¨ã€‚</span>
            <li>
                <span>If you see a question mark next to the cursor, right-click for an explanation.</span>
                <span>è‹¥çœ‹åˆ°é¼ æ¨™æ—æœ‰å•è™Ÿï¼Œé»æ“Šå³éµæœƒæœ‰è§£èªªã€‚</span>
            <li>
                <span>Rounding errors will accumulate, resulting in the final calculated value being different from the in-game value, usually within Â±50.</span>
                <span>æ¨å…¥èª¤å·®æœƒç´¯ç©ï¼Œå°è‡´æœ€å¾Œè¨ˆç®—å‡ºçš„æ•¸å€¼èˆ‡éŠæˆ²å…§çš„ä¸åŒï¼Œé€šå¸¸åœ¨â€‰Â±50â€‰å…§ã€‚</span>
            <li>
                <span>
                    <u class="posi">+</u><u class="nega">âˆ’</u>â€‰VSâ€‰<u class="posi">â–²</u><u class="nega">â–¼</u>: ğ‘<u class="nega">â€‰âˆ’â€‰ğ‘</u> means ğ‘ is the old value and the new value is ğ‘â€‰âˆ’â€‰ğ‘. 
                    ğ‘<u class="nega">â–¼ğ‘</u> means ğ‘ is the new value, which is ğ‘ less than the old value, so the old one is ğ‘â€‰+â€‰ğ‘.
                </span>
                <span>
                    <u class="posi" style="font-size:1.5em;line-height:0;">+</u><u class="nega" style="font-size:1.5em;line-height:0;">âˆ’</u>â€‰èˆ‡â€‰<u class="posi">â–²</u><u class="nega">â–¼</u>ï¼šğ‘<u class="nega">â€‰âˆ’â€‰ğ‘</u>â€‰è¡¨ç¤ºâ€‰ğ‘â€‰æ˜¯èˆŠå€¤ï¼Œæ–°å€¤æ˜¯â€‰ğ‘â€‰âˆ’â€‰ğ‘ã€‚
                    ğ‘<u class="nega">â–¼ğ‘</u>â€‰è¡¨ç¤ºâ€‰ğ‘â€‰æ˜¯æ–°å€¤ï¼Œæ¯”èˆŠå€¤ä¸‹é™äº†â€‰ğ‘ï¼Œæ•…èˆŠå€¤æ˜¯â€‰ğ‘â€‰+â€‰ğ‘ã€‚
                </span>
            <li>
                <span><img src="/rune/set/tolerance.webp"> effect affects character stats, but due to the complications in calculation with a title of vitality buff, it is neglected in this analyzer.</span>
                <span><img src="/rune/set/tolerance.webp"> æ•ˆæœæœƒå½±éŸ¿é¢ç‰ˆæ•¸å€¤ï¼Œä½†ç”±æ–¼èˆ‡åŠ ç”Ÿå‘½åŠ›çš„é ­éŠœä¸€åŒè£å‚™æ™‚è¨ˆç®—è¼ƒè¤‡é›œï¼Œæ•…æ­¤è¨ˆç®—å™¨å…§å¿½ç•¥ã€‚</span>      
            <li>
                <span>In-game bug: If you are not the host and are enjoying shared buffs from other team members, epic reinforcememnt stone on the secondary weapon will be treated as a normal stone.</span>
                <span>éŠæˆ²å…§â€‰Bugï¼šè‹¥ä½ ä¸æ˜¯å®¤é•·è€Œåˆäº«ç”¨å…¶ä»–éšŠå“¡çš„å…±äº«å¢ç›Šï¼Œå‰¯æ­¦å™¨çš„å²è©©å¼·åŒ–çŸ³æœƒç•¶æˆä¸€èˆ¬å¼·åŒ–çŸ³è¨ˆç®—ã€‚</span>    
    </details>
    <div>
        <nav>
            <a href="./" id="export"><span>Export storage</span><span>ä¸‹è¼‰å„²å­˜è³‡æ–™</span></a>
            <a href="" id="import"><label><span>Import storage</span><span>ä¸Šè¼‰å„²å­˜è³‡æ–™</span><input type="file"></label></a>
            <a href="#en" class="lang">English</a>
            <a href="#zh" class="lang"><span class="always">ä¸­æ–‡</span></a>
        </nav>
        <p></p>
        <menu>
            <li>
                <input type="checkbox" name="action" id="add">
                <label for="add"><span>Add char</span><span>å¢åŠ è§’è‰²</span></label>
            <li>
                <input type="checkbox" name="action" id="delete">
                <label for="delete"><span>Delete char</span><span>åˆªé™¤è§’è‰²</span></label>
            <li>
                <ol><li></ol>
                <label for="jump"><span>Jump to</span><span>è·³è‡³</span></label>
        </menu>
    </div>
</header>

<main hidden>
    <section></section>
</main>

<aside>
    <form id="tier"></form>
    <form id="grade"></form>
    <div>
        <span>Primary</span><span>ä¸»å±¬æ€§</span>
        <form id="primary"></form>
        <form id="level"></form>
    </div>
    <div>
        <span>Secondary</span><span>å‰¯å±¬æ€§</span>
        <form id="secondary"></form>
        <form>
            <input placeholder="+0/1.98"><input placeholder="+0/1.98"><input placeholder="+0/1.98">
        </form>
    </div>
    <div>
        <span>Set</span><span>å¥—è£</span>
        <form id="set"></form>
    </div>
</aside>

<dialog onclick="this.close()"></dialog>

<footer>
    <a href="/seal/"><span>Seal breaker</span><span>é­”ç </span></a>ãƒ»
    <a href="/property/"><span>Property</span><span>å±¬æ€§</span></a>
    <cite>By V. Man (@AEOQ) GuRan GCC 2021</cite>
</footer>

<template>
    <ul>
        <li id="invalid-tier"><span>Invalid tier</span><span>éšç´šä¸å¯èƒ½</span>
        <li id="invalid-grade"><span>Invalid grade</span><span>ç­‰ç´šä¸å¯èƒ½</span>
        <li id="invalid-primary"><span>Invalid primary property</span><span>ä¸»å±¬æ€§ä¸å¯èƒ½</span>
        <li id="invalid-level"><span>Invalid level</span><span>å¼·åŒ–ç­‰ç´šä¸å¯èƒ½</span>
        <li id="invalid-secondary"><span>Invalid secondary properties</span><span>å‰¯å±¬æ€§ä¸å¯èƒ½</span>
        <li id="invalid-secondary-level"><span>Invalid secondary reinforced times</span><span>å‰¯å±¬æ€§å¼·åŒ–æ¬¡æ•¸ä¸å¯èƒ½</span>
        <li id="unmatched-secondary"><span>Unmatched secondary number and reinforced times with grade and level</span><span>å‰¯å±¬æ€§æ•¸é‡åŠå¼·åŒ–æ¬¡æ•¸èˆ‡ç­‰ç´šä¸ç¬¦</span>
        <li id="invalid-set"><span>Invalid set</span><span>å¥—è£ä¸å­˜åœ¨</span>
    </ul>
</template>

<script type="module">
    import {A,E,O,Q} from 'https://aeoq.github.io/AEOQ.mjs'
    import {Menu, DB} from '/UIX.js'
    import {Helper, Picker} from './help.js'
    import Analyzer from './analyzer.js'

    window.onhashchange(location.hash.substring(1) || 'en');
    Promise.all(['power-analyzer', 'char-form', 'buff-form', 'rune-form', 'enemy-form'].map(el => customElements.whenDefined(el)))
        .then(() => Q('main').hidden = false);

    DB.show = store => DB.open().then(() => DB.getAll(store))
        .then(entries => entries.length ? entries.forEach(([i, entry]) => Analyzer.add({id: i, ...entry})) : Analyzer.add()),
    DB.show('characters');
    Q('#export').onclick = ev => DB.export(ev.target.closest('a'));
    Q('#import').onchange = ev => DB.import(ev.target.closest('a'));
    
    Picker();
    Helper.event();
    Helper.cursor();
    addEventListener('help', ev => ev.stopPropagation() ?? Helper.show(ev.detail));

    Menu();
    Q('input[name=action]', input => input.onchange = ev => Analyzer[input.id](ev.target.checked));
    Menu.action = () => Q(`power-analyzer:nth-child(${Q('.PI-selected input').value})`).scrollIntoView();
    Menu.arrange = () => {
        Q('menu>li:last-child ol').replaceChildren(
            ...[...Q('section').children].reverse().map((cal, i, ar) => E('li', 
                [E.radio(E('u', cal.el.name.value), {name: 'char', value: ar.length - i})], 
                {style: {backgroundColor: cal.el.color.value}}
            ))
        );
        Menu.align();
    }
    new MutationObserver(Menu.arrange).observe(Q('section'), {childList: true});
</script>
<style>
    aside {
        overflow-x:scroll;
        display:grid;
        grid-template:'tier level primary secondary set' auto 'grade level primary secondary set' auto / 11.2em max-content max-content max-content;
        >* {max-height:5em;}
    }
    aside form {
        display:flex; flex-wrap:wrap; align-items:center;
    }
    aside div {
        display:flex; align-items:center;
        border-left:.1rem solid var(--bg);
        padding:0 .5rem;

        span {
            width:1em; 
            color:var(--bg);
            margin-right:.2rem;
            
            &:lang(en) {writing-mode:sideways-lr;}
        }
        form {
            flex-flow:column wrap; justify-content:center;
            height:100%;
        }
    }
    aside label {
        padding:0 .5em; margin:.2em; 
        border-radius:9em; 
        background:var(--bg);
        position:relative;

        &.blue {outline:.1rem solid blue;}
        &.lime {outline:.1rem solid lime;}
        &.red {outline:.1rem solid red;}

        &:has(:checked):not(:has(img,prop-icon)) {background:#7387fa;;}
        &:has(:checked):has(img,prop-icon) {filter:brightness(2.5);}
        >* {vertical-align:middle !important;}
    }
    #tier {grid-area:tier;text-align:left;}
    #grade {grid-area:grade;}
    div:has(#primary) {grid-area:primary;}
    div:has(#secondary) {grid-area:secondary;}
    div:has(#set) {grid-area:set;}

    input:not([type]) {
        width:2.5em;
        margin:.2em;
        font-size:inherit;

        &:nth-child(1) {outline:.1em blue solid;}
        &:nth-child(2) {outline:.1em lime solid;}
        &:nth-child(3) {outline:.1em red solid;}
    }
</style>
